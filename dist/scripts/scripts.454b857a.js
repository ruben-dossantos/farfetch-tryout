"use strict";angular.module("farfetchApp",["ngCookies","ngResource","ngRoute","LocalStorageModule"]).config(["$routeProvider","localStorageServiceProvider",function(a,b){a.when("/",{templateUrl:"views/main.html",controller:"MainCtrl",controllerAs:"main"}).when("/bag",{templateUrl:"views/bag.html",controller:"BagCtrl",controllerAs:"bag"}).when("/wishlist",{templateUrl:"views/wishlist.html",controller:"WishlistCtrl",controllerAs:"wishlist"}).otherwise({redirectTo:"/"}),b.setPrefix("farfetch")}]),angular.module("farfetchApp").controller("MainCtrl",["$scope","$controller",function(a,b){angular.extend(this,b("CommonFunctionsCtrl",{$scope:a})),a.filteredProducts=[],angular.extend(a.global,{isProductInBagClass:function(b){if(a.global.isProductInStorage("bag",b))return"button--in-cart"},isProductInWishlistClass:function(b){if(a.global.isProductInStorage("wishlist",b))return"product__wishlisted-button"}}),a.model.getModel("product"),a.$watch("product",function(){a.product&&(a.filteredProducts=a.product.slice((a.pagination.page-1)*a.pagination.pageSize,a.pagination.pageSize*a.pagination.page))}),a.$watch("pagination.page",function(){a.product&&(a.filteredProducts=a.product.slice((a.pagination.page-1)*a.pagination.pageSize,a.pagination.pageSize*a.pagination.page))})}]),angular.module("farfetchApp").factory("Product",["$resource",function(a){return a("scripts/mock/:productId.json",{},{query:{method:"GET",params:{productId:"products"},isArray:!0}})}]),angular.module("farfetchApp").controller("BagCtrl",["$scope","$controller","Bag",function(a,b,c){angular.extend(this,b("CommonFunctionsCtrl",{$scope:a})),a.bagProducts=c.getBag(),angular.extend(a.global,{moveToWishlist:function(b){var c=a.global.addToWishlist(b);c?a.global.removeFromBag(b):a.global.showError("Product already in the wishlist")},checkout:function(){a.global.setObjectToStorage("bag",[]),c.setBag([]),a.bagProducts=[],a.global.showNotification("Thank you for buying with us!")}}),a.$watch(function(){return c.getBag()},function(b,c){b!==c&&(a.bagProducts=b)})}]),angular.module("farfetchApp").controller("WishlistCtrl",["$scope","$controller","Wishlist",function(a,b,c){angular.extend(this,b("CommonFunctionsCtrl",{$scope:a})),a.wishlistProducts=c.getWishlist(),angular.extend(a.global,{removeFromWishlist:function(b){var d=a.global.getObjectFromStorage("wishlist");a.wishlistProducts=[];for(var e=0;e<d.length;e++)d[e].id!==b.id&&a.wishlistProducts.push(d[e]);a.global.setObjectToStorage("wishlist",a.wishlistProducts),c.setWishlist(a.wishlistProducts),a.global.showNotification("Product removed from the wishlist")},moveToBag:function(b){var c=a.global.addToBag(b);c?a.global.removeFromWishlist(b):a.global.showError("Product already in the bag")}})}]),angular.module("farfetchApp").controller("CommonFunctionsCtrl",["$scope","$controller","$interval","localStorageService","Bag","Wishlist","Times",function(a,b,c,d,e,f,g){angular.extend(this,b("CommonModelsCtrl",{$scope:a})),a.global={getObjectFromStorage:function(a){return d.get(a)?JSON.parse(d.get(a)):[]},setObjectToStorage:function(a,b){d.set(a,JSON.stringify(b))},isProductInStorage:function(b,c){for(var d=a.global.getObjectFromStorage(b),e=0;e<d.length;e++)if(d[e].id===c.id)return!0;return!1},addToWishlist:function(b){var c=a.global.getObjectFromStorage("wishlist");return!a.global.isProductInStorage("wishlist",b)&&(c.push(b),a.global.setObjectToStorage("wishlist",c),f.setWishlist(c),a.global.showNotification("Product added to the wishlist"),!0)},addToBag:function(b){var c=a.global.getObjectFromStorage("bag");return!a.global.isProductInStorage("bag",b)&&(c.push(b),a.global.setObjectToStorage("bag",c),e.setBag(c),a.global.showNotification("Product added to the bag"),!0)},removeFromBag:function(b){var c=a.global.getObjectFromStorage("bag");a.bagProducts=[];for(var d=0;d<c.length;d++)c[d].id!==b.id&&a.bagProducts.push(c[d]);a.global.setObjectToStorage("bag",a.bagProducts),e.setBag(a.bagProducts),a.global.showNotification("Product removed from the bag")},sumBag:function(){var b=0;return angular.forEach(a.global.getObjectFromStorage("bag"),function(a){b+=parseInt(a.price)}),b},getNumber:function(a){return new Array(a)},previousPage:function(){a.pagination.page>1&&(a.pagination.page=a.pagination.page-1)},nextPage:function(){a.pagination.page<a.pagination.totalPages&&(a.pagination.page=a.pagination.page+1)},changePage:function(b){a.pagination.page=b},showNotification:function(b){a.showNotification=!0,a.notification=b,c(function(){a.showNotification=!1},g.notificationTimeout)},showError:function(b){a.showError=!0,a.error=b,c(function(){a.showError=!1},g.errorTimeout)}},e.setBag(a.global.getObjectFromStorage("bag")),f.setWishlist(a.global.getObjectFromStorage("wishlist"))}]),angular.module("farfetchApp").factory("Bag",function(){var a=[];return{getBag:function(){return a},setBag:function(b){a=b}}}),angular.module("farfetchApp").controller("CommonNavbarCtrl",["$scope","$controller","Bag","Wishlist",function(a,b,c,d){angular.extend(this,b("CommonFunctionsCtrl",{$scope:a})),a.bag=c.getBag(),a.wishlist=d.getWishlist(),a.$watch(function(){return c.getBag()},function(b,c){b!==c&&(a.bag=b)}),a.$watch(function(){return d.getWishlist()},function(b,c){b!==c&&(a.wishlist=b)})}]),angular.module("farfetchApp").factory("Wishlist",function(){var a=[];return{getWishlist:function(){return a},setWishlist:function(b){a=b}}}),angular.module("farfetchApp").controller("CommonModelsCtrl",["$scope","Product",function(a,b){a.objects={product:b},a.pagination={page:1,pageSize:6},a.model={getModel:function(b){a.objects[b].query(function(c){a[b]=c,a[b].count=c.length,a.pagination.totalPages=Math.ceil(c.length/a.pagination.pageSize)})}}}]),angular.module("farfetchApp").constant("Times",{notificationTimeout:4e3,errorTimeout:1e4});